---
layout: default
title: Training Tesseract
parent: Tigrinya OCR
nav_order: 3
---
# Training Tesseract for Tigrinya OCR

Now we are going to generate *.traineddata file which can later be loaded to Tesseract, so it can recognize characters the way we want it.

Run the following commands using 'box.train' config to create the .tr file.

```
tesseract -l tir tir.Abyssinica_SIL.exp1.tif tir.Abyssinica_SIL.exp1 nobatch box.train
```

Then we are going to extract the charset from the box files. Before creating unicharset file we have make sure that we have the proper *.unicharset file in our working directory. In our case we need Ethiopic.unicharset and Latin.unicharset. Download both files from [Here](https://github.com/tesseract-ocr/langdata).
The command to create 'unichrset' file is

```
unicharset_extractor.exe tir.Abyssinica_SIL.exp1.box
```

Check if we have correct unicharset file:
Example of wrong unichrset file:

	56
	NULL 0 Common 0
	Joined 7 0,255,0,255,0,0,0,0,0,0 Latin 1 0 1 Joined	# Joined [4a 6f 69 6e 65 64 ]a
	|Broken|0|1 15 0,255,0,255,0,0,0,0,0,0 Common 2 10 2 |Broken|0|1	# Broken
	ኣ 1 0,255,0,255,0,0,0,0,0,0 Ethiopic 3 0 3 ኣ	# ኣ [12a3 ]x
	9 8 0,255,0,255,0,0,0,0,0,0 Common 4 2 4 9	# 9 [39 ]0
	6 8 0,255,0,255,0,0,0,0,0,0 Common 5 2 5 6	# 6 [36 ]0
	4 8 0,255,0,255,0,0,0,0,0,0 Common 6 2 6 4	# 4 [34 ]0
	2 8 0,255,0,255,0,0,0,0,0,0 Common 7 2 7 2	# 2 [32 ]0
	0 8 0,255,0,255,0,0,0,0,0,0 Common 8 2 8 0	# 0 [30 ]0
	7 8 0,255,0,255,0,0,0,0,0,0 Common 9 2 9 7	# 7 [37 ]0
	:

Example of correct unichrset file:

	56
	NULL 0 NULL 0
	Joined 7 0,69,188,255,486,1218,0,30,486,1188 Latin 1 0 1 Joined	# Joined [4a 6f 69 6e 65 64 ]a
	|Broken|0|1 15 0,69,186,255,892,2138,0,80,892,2058 Common 2 10 2 |Broken|0|1	# Broken
	ኣ 1 62,66,249,255,161,165,11,14,185,188 Ethiopic 3 0 3 ኣ	# ኣ [12a3 ]x
	9 8 60,64,251,255,132,142,7,11,158,161 Common 4 2 4 9	# 9 [39 ]0
	6 8 62,64,251,255,132,142,9,11,158,161 Common 5 2 5 6	# 6 [36 ]0
	4 8 64,66,244,255,139,149,2,8,158,161 Common 6 2 6 4	# 4 [34 ]0
	2 8 64,66,251,255,128,147,7,11,158,161 Common 7 2 7 2	# 2 [32 ]0
	0 8 62,62,251,255,130,147,7,11,158,161 Common 8 2 8 0	# 0 [30 ]0
	7 8 62,64,247,255,121,140,4,15,158,161 Common 9 2 9 7	# 7 [37 ]0
        :

If we get wrong unicharset file run the following command to correct it:

```
set_unicharset_properties --U unicharset --script_dir . --O unicharset
```


To tell Tesseract informations about the font, create font properties file (tir.font_properties) and put the followig line in the file and save it

```
tir.Abissinica_SIL 0 0 0 1 0
```

Alternatively, run the followig command to create the file and update its content:

```
echo "tir.Abissinica_SIL 0 0 0 1 0" > tir.font_properties
```

### Run the following commands [source](http://manpages.ubuntu.com/manpages/cosmic/man1/tesseract.1.html)

**i. Run 'shapeclustering'** - shape clustering training for Tesseract. 'shapeclustering' takes extracted feature .tr files (generated by 'tesseract' run in a special mode from box files) and produces a file shapetable and an enhanced unicharset. This program is still experimental, and is not required (yet) for training Tesseract. It creates 'shapetable' file.
The synopsis is as follows:

```
shapeclustering -D output_dir -U unicharset -O mfunicharset -F font_props -X xheights FILE...
```

Where:
-U FILE: The unicharset generated by unicharset_extractor.
-D dir: Directory to write output files to.
-F font_properties_file: (Input) font properties file, where each line is of the following form, where each field other than the font name is 0 or 1:'font_name' 'italic' 'bold' 'fixed_pitch' 'serif' 'fraktur'
-X xheights_file: (Input) x heights file, each line is of the following form, where xheight is calculated as the pixel x height of a character drawn at 32pt on 300 dpi. [ That is, if base x height + ascenders + descenders = 133, how much is x height? ] 'font_name' 'xheight'
-O FILE: The output unicharset that will be given to combine_tessdata(1).

So our command will be as follows:

```
shapeclustering -F  tir.font_properties -U  unicharset tir.Abyssinica_SIL.exp1.tr
```

**ii. Run 'mftraining'** - feature training for Tesseract. mftraining takes a list of .tr files, from which it generates the files inttemp (the shape prototypes), shapetable, and pffmtable (the number of expected features for each character). (A fourth file called Microfeat is also written by this program, but it is not used.)
The synopsis is as follows:

```
mftraining -U unicharset -O lang.unicharset FILE...
```

Where:
-U FILE: The unicharset generated by unicharset_extractor.
-F font_properties_file: (Input) font properties file, where each line is of the following form, where each field other than the font name is 0 or 1:'font_name' 'italic' 'bold' 'fixed_pitch' 'serif' 'fraktur'
-X xheights_file: (Input) x heights file, each line is of the following form, where xheight is calculated as the pixel x height of a character drawn at 32pt on 300 dpi. [ That is, if base x height + ascenders + descenders = 133, how much is x height? ] 'font_name' 'xheight'
-D dir: Directory to write output files to.
-O FILE: The output unicharset that will be given to combine_tessdata(1).

So our command will be as follows:

```
mftraining -F tir.font_properties -U unicharset -O tir.unicharset tir.Abyssinica_SIL.exp1.tr
```

This command creates the following files: pffmtable, inttemp and tir.unicharset

**iii. Run 'cntraining'** - character normalization training for Tesseract. 'cntraining' takes a list of .tr files, from which it generates the normproto data file (the character normalization sensitivity prototypes).
The synopsis is as follows:

```
cntraining [-D dir] FILE...
```

Where dir is an optional which is directory to write output files to.

```
cntraining tir.Abyssinica_SIL.exp1.tr
```

This command creates normproto file.

**iv. Rename files**
Now rename all files created by mftrainig and cntraining (add the prefix tir)

	mv inttemp tir.inttemp
	mv normproto tir.normproto
	mv pffmtable tir.pffmtable
	mv shapetable tir.shapetable

**v. Create tir.traineddata file**
Finally combine tessdata using the following command

```
combine_tessdata tir
```

This command creates the tir.traineddata file.